{"version":3,"sources":["./src/app/Services/productos.service.ts","./src/app/Services/variaciones-stocks.service.ts","./src/app/add-producto-venta/add-producto-venta-routing.module.ts","./src/app/add-producto-venta/add-producto-venta.module.ts","./src/app/models/variacionStock.ts"],"names":[],"mappings":"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","file":"add-producto-venta-add-producto-venta-module.js","sourcesContent":["import { Injectable } from '@angular/core';\nimport { AngularFirestore } from 'angularfire2/firestore';\nimport * as firebase from 'firebase';\nimport { map } from 'rxjs/operators';\nimport { Producto } from '../models/producto';\nimport { variacionStock } from '../models/variacionStock';\nimport { BaseService } from './base.service';\nimport { ComerciosService } from './comercios.service';\nimport { KeywordService } from './keyword.service';\nimport { VariacionesStocksService } from './variaciones-stocks.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProductosService extends BaseService {\n\n  private woocommerceSyncPath =\"\"\n  constructor(\n    protected afs: AngularFirestore,\n    private comerciosService:ComerciosService,\n    private variacionesStockService:VariacionesStocksService\n  ) {\n    super(afs);   \n    this.comerciosService.getSelectedCommerce().subscribe(data=>{\n     // let comercio_seleccionadoId = localStorage.getItem('comercio_seleccionadoId'); \n      if(data){      \n        this.setPath('comercios/'+data.id+'/productos') \n      }     \n    })\n      \n  }\n\n  getWoocommerceValue(productoId){\n    this.woocommerceSyncPath = this.path+'/'+productoId+'/woocommerceSincData'\n    return this.afs.collection(this.woocommerceSyncPath).doc(\"1\").get()\n    .pipe(\n        map(doc => {\n            if (doc.exists) {\n        /* workaround until spread works with generic types */\n                const data = doc.data() as any;\n                const id = doc.id;\n                data.fromCache = doc.metadata.fromCache;\n                return { id, ...data };\n            }\n        })\n    ); \n  }\n\n  updateWoocommerceValues(productoId,values){\n    this.woocommerceSyncPath = this.path+'/'+productoId+'/woocommerceSincData'\n    this.afs.collection(this.woocommerceSyncPath).doc(\"1\").set(values).then(data=>{\n      console.log(\"Actualizados los valores de woocommerce\")\n    })\n  }\n\n  \n  deleteWoocommerceValues(id){\n    this.woocommerceSyncPath = this.path+'/'+id+'/woocommerceSincData'\n    this.afs.collection(this.woocommerceSyncPath).doc(\"1\").delete().then(data=>{\n      console.log(\"Actualizados los valores de woocommerce\")\n    })\n  }\n\n\n  getCollection(){\n    let comercio_seleccionadoId = localStorage.getItem('comercio_seleccionadoId'); \n    return 'comercios/'+comercio_seleccionadoId+'/productos';\n  }\n\n  \n  public getByName(name){\n    return this.afs.collection(this.path,ref=>ref.where(\"nombre\",\"==\",name)).snapshotChanges().pipe(\n      map(changes => {\n          return changes.map(a => {\n              const data:any = a.payload.doc.data();\n              data.id = a.payload.doc.id;\n              data.fromCache = a.payload.doc.metadata.fromCache;\n              return data;\n          });\n      })\n    );   \n  }\n\n  public updateStock(delta,productoId){ \n\n    var sfDocRef = this.afs.firestore.collection(this.path).doc(productoId);\n\n    return this.afs.firestore.runTransaction((transaction) => {\n      // This code may get re-run multiple times if there are conflicts.\n      return transaction.get(sfDocRef).then((sfDoc) => {\n          if (!sfDoc.exists) {\n              throw \"Document does not exist!\";\n          }\n          \n          var newStock = sfDoc.data().stock + delta;\n          transaction.update(sfDocRef, { stock: newStock });\n\n          let vStock:variacionStock = new variacionStock();\n          vStock.productoId = productoId; \n          vStock.stock = sfDoc.data().stock;\n          this.variacionesStockService.setPathProducto(productoId);\n          this.variacionesStockService.add(vStock).then(resp =>{           \n\n          }); \n\n      });\n  }).then(() => {\n      \n          \n          \n    \n  }).catch((error) => {\n      console.log(\"Transaction failed: \", error);\n  });\n\n  }\n\n  /*public create(data:Producto) {\n\n    this.keywordService.agregarKeywords(data, [data.nombre,...data.categorias]);\n\n    let time = new Date();\n      const param = JSON.parse(JSON.stringify(data));\n      this.firestore.doc(this.getCollection()+\"/\"+data.id).set( {...param,\n        createdAt: time,\n      });   \n     \n  }*/\n/*\n  public getAll() {   \n    return this.firestore.collection(this.getCollection(),ref=> ref.orderBy('nombre')).snapshotChanges();\n  }*/\n\n /* public update(data) {\n\n    console.log(data)\n\n    let time = new Date();\n\n    const param = JSON.parse(JSON.stringify(data));\n    return this.firestore.collection(this.getCollection()).doc(data.id).set({...param,\n      updatedAt: time,\n    },{merge:true});\n  }*/ \n\n\n}\n","import { Injectable } from '@angular/core';\nimport { AngularFirestore } from 'angularfire2/firestore';\nimport { map } from 'rxjs/operators';\nimport { BaseService } from './base.service';\nimport { ComerciosService } from './comercios.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class VariacionesStocksService extends BaseService {\n\n  private comercioId = \"\";\n  constructor(\n    protected afs: AngularFirestore,\n    private comerciosService:ComerciosService\n    ) {     \n      super(afs); \n      this.comerciosService.getSelectedCommerce().subscribe(data=>{\n        if(data){\n         this.comercioId = data.id\n         }        \n      })\n  }\n\n\n  setPathProducto(productoId){\n    this.setPath('comercios/'+this.comercioId+'/productos/'+productoId+'/variacionesStock')  \n  }\n\n  getLast(productoId){\n    this.setPathProducto(productoId)\n\n    return this.afs.collection(this.path, ref => ref.limit(1))\n            .snapshotChanges()\n            .pipe(\n                map(changes => {\n                    return changes.map(a => {\n                        const data:any = a.payload.doc.data();\n                        data.id = a.payload.doc.id;\n                        data.fromCache = a.payload.doc.metadata.fromCache;\n                        if(data.createdAt instanceof String || Number){\n                            data.createdAt = new Date(Number(data.createdAt))\n                        }\n                        else{\n                            data.createdAt = data.createdAt.toDate();\n                        }\n                           \n                        return data;\n                    });\n                })\n            );     \n\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { AddProductoVentaPage } from './add-producto-venta.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: AddProductoVentaPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class AddProductoVentaPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { AddProductoVentaPageRoutingModule } from './add-producto-venta-routing.module';\n\nimport { AddProductoVentaPage } from './add-producto-venta.page';\nimport { ComponentsModule } from '../Components/components.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ComponentsModule,\n    FormsModule,\n    IonicModule,\n    AddProductoVentaPageRoutingModule\n  ],\n  declarations: [AddProductoVentaPage]\n})\nexport class AddProductoVentaPageModule {}\n","export class variacionStock{\r\n    public productoId =\"\";\r\n    public stock = 0;\r\n\r\n\tconstructor(\r\n\t\t\r\n\t\t){\r\n    }\r\n    \r\n    public asignarValores(init?: Partial<variacionStock>) {\r\n        Object.assign(this, init);\r\n    }\r\n}"],"sourceRoot":"webpack:///"}